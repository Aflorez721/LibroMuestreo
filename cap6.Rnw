%--------------------
<<echo=FALSE, message=FALSE>>=
library(TeachingSampling)
data(BigLucy)
library(xtable)
library(ggplot2)
library(gridExtra)
options(scipen = 100, digits = 2)
set.seed(12345)
library(knitr)
knit_theme$set("acid")
@
%--------------------

\chapter[Muestreo de conglomerados]{Muestreo de conglomerados}

\begin{quote}
\textsf{En encuestas complejas, los grupos poblacionales de elementos que se forman naturalmente como barrios, municipios o escuelas pueden ser tratados como unidades de muestreo. Este tipo de esquemas de muestreo ayudan a aumentar el tamaño de muestra manteniendo el costo de la encuesta.}
\begin{flushright}
\textsf{Risto Lehtonen (2004)}
\end{flushright}
\end{quote}


Las estrategias de muestreo para elementos tienen un común denominador: el marco de muestreo y su prolija identificación y ubicación de los elementos poblacionales, de todos y cada uno de ellos. Cabe resaltar que en la práctica no es muy común el uso de diseños de muestreo que seleccionen muestras de elementos directamente. Lo anterior se debe más a cuestiones financieras y logísticas que a problemas de eficiencia estadística. Piense en lo siguiente: cada investigación requiere un marco de muestreo. Son miles de millares las investigaciones realizadas al año y deberían existir tantos marcos de muestreo como investigaciones realizadas. Por cuestiones de tipo logístico la consecución de un marco de muestreo de elementos es muy costosa porque implicaría realizar un censo, enumerando, identificando y ubicando a cada elemento de la población y esto es, por supuesto, algo utópico.

Pensando en el más sencillo de los diseños de muestreo, el costo financiero de realizar un estudio mediante un diseño de muestreo aleatorio simple es muy elevado. Por ejemplo suponga que se desea realizar un estudio para evaluar la calidad de vida de las personas en un determinado país. Si llegara a existir un marco de muestreo de elementos, realizar (o seleccionar) una muestra aleatoria simple demandaría la contratación de un encuestador por cada persona encuestada, puesto que la dispersión geográfica natural de los elementos seleccionados en la muestra aleatoria simple sería demasiado alta.

En el caso anterior, aunque se tuviera un marco de muestreo de elementos, el costo financiero de realizar una muestra aleatoria sería demasiado alto. Una forma de realizar muestras probabilísticas a falta de un marco de muestreo de elementos es seleccionar conglomerados\footnote{Agrupación natural de objetos} de elementos y realizar el proceso de medición en cada conglomerado. \citeasnoun{Coc} plantea que, por cuestiones logísticas, es más eficiente seleccionar una muestra de 20 bloques de hogares, cada bloque con 30 hogares, que seleccionar una muestra aleatoria de 600 hogares. En el primer caso sólo se necesitaría la presencia de un encuestador por bloque, mientras que en el segundo, posiblemente, se necesite la presencia de muchos más encuestadores.

Siempre que se desee seleccionar una muestra probabilística se debe tener un marco de muestreo de manera obligatoria, en los casos en donde se carece de marco muestral es necesario construir uno. Sin embargo, el costo financiero y logístico de levantar un marco de muestreo para elementos es muy alto, en la mayoría de ocasiones. Una forma de construir marcos de muestreo de bajo costo es mediante la aplicación de un diseño de muestreo por conglomerados. Estos conglomerados tienen la ventaja de ser agrupaciones de elementos que se forman de manera na\-tu\-ral y además existen entidades gubernamentales que se ocupan de registrar y actualizar la lista de conglomerados existentes en cada sector. Por ejemplo, existe una entidad encargada de la actualización de los sectores cartográficos de una ciudad, existe una entidad encargada de la actualización de los negocios en un sector, existe una entidad que recopila la información concerniente a la ubicación de las escuelas, etc. Para cada entidad existe también un registro de estas aglomeraciones y este será el marco de muestreo que se utilizará en la etapa de diseño.

Por lo tanto, el marco de muestreo contendrá la ubicación e identificación de cada uno de los conglomerados de elementos existentes en la población. Con este marco de conglomerados, se aplica un diseño de muestreo y una muestra es seleccionada. Cada conglomerado seleccionado en la muestra es visitado y el proceso de medición se realiza para todos los elementos pertenecientes al mismo. Entonces, si el conglomerado seleccionado es una sección cartográfica de la ciudad, se aplicará la encuesta a todos y cada uno de los elementos que conforman la sección. Si el conglomerado seleccionado es una escuela, se aplicará el instrumento de medición a todos y cada uno de los alumnos de la escuela. En otras palabras, se realiza un censo en cada conglomerado que haya sido seleccionado en la muestra.

Por supuesto, existe una ganancia significativa en términos operativos, logísticos y financieros. Sin embargo, esta ganancia tiene un precio... el precio a pagar está dado en términos de eficiencia estadística de la estrategia de muestreo. Revisando un poco el proceso de aglomeración, hay que tener en cuenta que los conglomerados de elementos tienden, en la mayoría de los casos, a ser homogéneos con respecto a los valores de la característica de interés $y$. Lo anterior se da porque la agrupación se realiza de forma natural, es decir lo hogares, las secciones car\-to\-grá\-fi\-cas, las villas, las escuelas, las prisiones, etc. tienden a formarse de manera natural y homogénea. Así que la pérdida de eficiencia estadística es causada por el efecto de conglomerado que conlleva la selección de unidades homogéneas que no contienen información nueva sino, de alguna manera, repetida. ¿Qué nueva información se obtiene, acerca de la población, al añadir un nuevo elemento del mismo conglomerado en la muestra? 

Entre más grande sea el tamaño de la sub-muestra en los conglomerados, entonces más grande será el efecto de diseño. Si dentro de cada conglomerado, el comportamiento de la característica de interés $y$ reflejará el comportamiento estructural de la misma en la población, entonces la eficiencia de una estrategia de muestreo por conglomerados sería similar a la de una muestra aleatoria simple. Pero, en la práctica, la homogeneidad interna de los conglomerados aumenta el error de muestreo. Un error, por desgracia demasiado frecuente, entre los investigadores neófitos es analizar una muestra por conglomerados como una muestra aleatoria simple\footnote{No es prudente, ni correcto analizar una muestra por conglomerados como si fuera una muestra aleatoria simple porque los errores estándar serán mayores y la interpretación de los resultados será errónea.}.

En general se tienen lo siguientes comentarios acerca del muestreo por conglomerados:
\begin{itemize}
\item Utilizamos muestreo por conglomerados sí:
\begin{enumerate}
\item La construcción de un marco de muestreo de elementos es muy difícil, muy costosa o imposible de conseguir. Enumerar abejas, enumerar clien\-tes, enlistar árboles en un sector, enlistar hogares en los barrios con\-glo\-me\-ra\-dos (dispersión geográfica, reducción de costos).
\item La población objetivo se encuentra muy dispersa (geográficamente) o aparece en agrupaciones naturales: familias, escuelas, etc.
\end{enumerate}
\item Los elementos individuales de una población sólo participan en la muestra si pertenecen a un conglomerado incluido en la muestra.
\item El muestreo estratificado aumenta la precisión de las estimaciones, mientras que el muestreo por conglomerados tiende a disminuirla. Es un precio que se paga al no poseer un marco de muestreo definido para los elementos de la población objetivo.
\item Al obtener una muestra de elementos que pertenecen a un con\-glo\-me\-ra\-do repetimos la información del conglomerado (dada la agrupación natural). Lo ideal es conseguir información nueva en cada individuo, por lo anterior se pierde precisión en las estimaciones.
\end{itemize}

\section{Fundamentos teóricos y notación}

\index{Diseño de muestreo de conglomerados}Suponga que la población de elementos
\begin{equation*}
U=\{1,...,k,...,N\}.
\end{equation*}
se divide en $N_I$ sub-grupos poblacionales, llamados \textbf{conglomerados} y denotados como $U_I=\{U_1,\ldots,U_{N_I}\}$.

La población de conglomerados estará dada, sin pérdida de generalidad, por
\begin{equation*}
U_I=\{1,\dots,N_I\}.
\end{equation*}

Estos definen una partición de la población en tal forma que
\begin{enumerate}
  \item $U=\bigcup_{i=1}^{N_I}U_i$
  \item $U_i \bigcap U_j = \emptyset$ para todo $i\neq j$
\end{enumerate}

El número de unidades $N_i$ en el conglomerado $i$-ésimo se llama \textbf{tamaño del conglomerado} tal que
\begin{equation*}
N=\sum_{i=1}^{N_I}N_i,
\end{equation*}

donde $N$ es el tamaño de la población $U$. Con la población dividida en $N_I$ conglomerados, los parámetros poblacionales de interés pueden escribirse como:
\begin{enumerate}
\item El total poblacional,
\begin{equation}
t_y=\sum_{k \in U}y_k=\sum_{i=1}^{N_I}\sum_{k\in U_i}y_k=\sum_{i=1}^{N_I}t_{yi}
\end{equation}
donde $t_{yi}=\sum_{k\in U_i}y_k$ es el total del $i$-ésimo conglomerado.
\item La media poblacional,
\begin{equation}
\bar{y}_U=\frac{\sum_{k \in U}y_k}{N}=\frac{1}{N}\sum_{i=1}^{N_I}\sum_{k\in U_i}y_k=\frac{1}{N}\sum_{i=1}^{N_I}N_i\bar{y}_i
\end{equation}
donde $\bar{y}_i=\dfrac{1}{N_i}\sum_{k\in U_i}y_k$ es la media del $i$-ésimo conglomerado.
\end{enumerate}

El esquema general del diseño de muestreo por conglomerados está definido de la siguiente forma

\begin{enumerate}
  \item Seleccionar una muestra probabilística $s_I$\footnote{Nótese que si $s_I$ representa la muestra realizada de conglomerados, entonces $S_I$ representa la muestra aleatoria la cual es una variable aleatoria.} de conglomerados de la población $U_I$ mediante un diseño de muestreo tal que
      \begin{equation}
        Pr(S_I=s_I)=p_I(s_I) \ \ \ \ \ \ \ \ \ \ \ \ \text{para todo } s_I\in Q_I  .
      \end{equation}
      donde $Q_I$ es el soporte conteniendo todas las posibles muestras de con\-glo\-me\-ra\-dos.
  \item Todos y cada uno de los elementos pertenecientes a los conglomerados seleccionados son observados y medidos.
\end{enumerate}

El tamaño de la muestra aleatoria de conglomerados está dado por

\begin{enumerate}
  \item $n(S_I)=n_I$ si la muestra es de tamaño fijo, $n(S_I)$ si la muestra es de tamaño variable
  \item $n(S_I)=m_I$ si la muestra es seleccionada con reemplazo
\end{enumerate}

La muestra aleatoria de elementos viene caracterizada por

\begin{equation}
S=\bigcup_{i\in S_I}U_i
\end{equation}

y el tamaño de la muestra\footnote{Dado que, por lo general, el tamaño de los conglomerados varía, se tiene que $n(S)$ es ge\-ne\-ral\-men\-te aleatorio incluso si $n(S_I)$ es de tamaño fijo.} de elementos por

\begin{equation}
n(S)=\sum_{i\in S_I}N_i
\end{equation}

Si es posible construir o definir un soporte $Q_I$, también será posible definir (al menos teóricamente) un soporte general $Q$ de elementos conteniendo las posibles muestras de elementos pertenecientes a los con\-glo\-me\-ra\-dos seleccionados.

\begin{Eje}
Nuestra población ejemplo $U$ dada por

\begin{center}
$U=\{\textbf{Yves, Ken, Erik, Sharon, Leslie}\}$
\end{center}

se divide en tres conglomerados de la siguiente forma

\begin{center}
$U_1=\{\textbf{Yves, Ken}\}$
\end{center}

el segundo conformado por

\begin{center}
$U_2=\{\textbf{Erik,Sharon}\}$
\end{center}

y el último conglomerado dado por

\begin{center}
$U_3=\{\textbf{Leslie}\}$
\end{center}

Es claro que, en este caso particular, se tienen $N_I=3$ conglomerados de tamaño diferentes. De esta manera, la población de conglomerados queda definida por

\begin{center}
$U_I=\{\textbf{$U_1, U_2, U_3$}\}$
\end{center}

Suponga que se selecciona una muestra $s_I$ de conglomerados de tamaño $n_I=2$. La definición del soporte $Q_I$ en \textsf{R} se hace mediante el uso de la función \texttt{Support} del paquete \texttt{TeachingSampling} aplicada a la información a nivel de los conglomerados de la siguiente manera.

<<warning=FALSE>>=
U <- c("Yves", "Ken", "Erik", "Sharon", "Leslie")
U1 <- c("Yves", "Ken")
U2 <- c("Erik", "Sharon")
U3 <- c("Leslie")
UI <- c("U1","U2","U3")

N1 <- length(U1)
N2 <- length(U2)
N3 <- length(U3)

ty1 <- sum(32, 34)
ty2 <- sum(46, 89)
ty3 <- sum(35)

tyI <- c(ty1, ty2, ty3)
ty <- sum(ty1, ty2, ty3)

NI <- 3
nI <- 2

QI  <-  Support(NI, nI, UI)
QI
@
\end{Eje}

\subsection[El estimador de Horvitz-Thompson]{El estimador de Horvitz-Thompson}

Nótese que en el esquema general del muestreo por conglomerados, se utiliza un diseño de muestreo para la selección de los conglomerados en la muestra. Este diseño de muestreo $p_I(s_I)$ puede ser cualquiera de los diseños vistos en los capítulos anteriores, aplicados a la selección, esta vez no de elementos, sino de con\-glo\-me\-ra\-dos. En general, dado el soporte $Q_I$, $p_I(s_I)$ puede ser:

\begin{itemize}
\item \textbf{Sin reemplazo:} si todas las posibles muestras en $Q_I$ son sin reemplazo. Muestreo aleatorio simple, Bernoulli, Sistemático, Poisson, $\pi$PT o estratificado simple.
\item \textbf{Con reemplazo:} si todas las posibles muestras en $Q_I$ son con reemplazo. Muestreo aleatorio simple con reemplazo o muestreo PPT.
\item \textbf{De tamaño fijo:} si todas las posibles muestras en $Q$ tienen el mismo tamaño de muestra $n(S_I)=n_I$.
\end{itemize}

Nótese que el diseño de muestreo $p_I(s_I)$ induce probabilidades de inclusión sobre los conglomerados las cuales están definidas como sigue a continuación.

\begin{Defi}
\index{Probabilidad de inclusión}La probabilidad de inclusión del conglomerado $i$-ésimo está dada por
\begin{equation}
\pi_{Ii}=Pr(i \in S_I)=\sum_{s_I \ni i} p_I(s_I).
\end{equation}
mientras que la probabilidad de inclusión de los conglomerados $i$-ésimo y $j$-ésimo están dadas por
\begin{equation}
\pi_{Iij}=Pr(i\in S_I\text{ y }j\in S_I)=\sum_{s_I \ni \text{ $i$ y $j$}} p_I(s_I).
\end{equation}
respectivamente. Por supuesto, $\pi_{Iii}=\pi_{Ii}$.
\end{Defi}

Asimismo, debido a la naturaleza jerárquica de la agrupación de elementos en los conglomerados, el siguiente resultado muestra las probabilidades de inclusión al nivel de los elementos de la población.

\begin{Res}
La probabilidad de que el $k$-ésimo elemento, sea incluido en la muestra $S$ está dada por
\begin{equation}
\pi_{k}=\pi_{Ii} \ \ \ \text{si $k\in U_i$}
\end{equation}
Por otro lado, la probabilidad de inclusión de los elementos $k$-ésimo y $l$-ésimo está dada por
\begin{equation}
  \pi_{kl}=\begin{cases}
            \pi_{Ii}, & \text{si $k,l \in U_i$},\\\\
            \pi_{Iij}, & \text{si $k\in U_i, l\in U_j, i\neq j$}.
            \end{cases}
\end{equation}
\end{Res}

Una vez definidas las probabilidades de inclusión se define la estrategia de muestreo con el uso del estimador de Horvitz-Thompson, dado por el siguiente resultado

\begin{Res}
Bajo un diseño de muestreo por conglomerados, el estimador de Horvitz-Thompson para el total $t_{y}$, su varianza y su varianza estimada están dados por
\begin{equation}
\hat{t}_{y,\pi}=\sum_{i\in S_I}\frac{t_{yi}}{\pi_{Ii}}
\end{equation}
\begin{equation}
Var_1(\hat{t}_{y,\pi})=\sum\sum_{U_I}\Delta_{Iij}\frac{t_{yi}}{\pi_{Ii}}\frac{t_{yj}}{\pi_{Ij}}.
\end{equation}
\begin{equation}
\widehat{Var}_1(\hat{t}_{y,\pi})=\sum\sum_{S_I} \dfrac{\Delta_{Iij}}{\pi_{Iij}}\frac{t_{yi}}{\pi_{Ii}}\frac{t_{yj}}{\pi_{Ij}}
\end{equation}
respectivamente, con $\Delta_{Iij}=\pi_{Iij}-\pi_{Ii}\pi_{Ij}$ y $t_{yi}$ el total del $i$-ésimo conglomerado seleccionado. Nótese que $\hat{t}_{y,\pi}$ es insesgado para $t_y$ y que $\widehat{Var}_1(\hat{t}_{y,\pi})$ es insesgado para $Var_1(\hat{t}_{y,\pi})$.
\end{Res}

\begin{proof}
Para el estimador, se tiene que
\begin{align*}
\hat{t}_{y,\pi}&=\sum_{k\in S}\frac{y_k}{\pi_k}\\
&=\sum_{i\in S_I}\sum_{k\in U_i}\frac{y_k}{\pi_k}\\
&=\sum_{i\in S_I}\frac{1}{\pi_{Ii}}\sum_{k\in U_i}y_k\\
&=\sum_{i\in S_I}\frac{t_{yi}}{\pi_{Ii}}.
\end{align*}
Para el cálculo de la varianza es necesario verificar que
\begin{equation}
\Delta_{kl}=
\Delta_{Iij}=
\left\{
\begin{array}{ll}
\pi_{Ii}-\pi_{Ii}^2, & \hbox{si $k,l\in U_i$;} \\
\pi_{Iij}-\pi_{Ii}\pi_{Ij}, & \hbox{si $k\in U_i$, $l\in U_j$ y $i\neq j$}
\end{array}
\right.
\end{equation}
Entonces se tiene que
\begin{align*}
Var_1(\hat{t}_{y,\pi})&=\sum_{k\in U}\sum_{l\in U}\Delta_{kl}\frac{y_k}{\pi_k}\frac{y_l}{\pi_l}\\
&=\sum_{i\in U_I}\sum_{k\in U_i}\sum_{j\in U_I}\sum_{l\in U_j}\Delta_{kl}\frac{y_k}{\pi_{Ii}}\frac{y_l}{\pi_{Ij}}\\
&=\sum_{i\in U_I}\sum_{j\in U_I}\Delta_{Iij}\frac{1}{\pi_{Ii}}\frac{1}{\pi_{Ij}}\sum_{k\in U_i}y_k\sum_{l\in U_j}y_l\\
&=\sum\sum_{U_I}\Delta_{Iij}\frac{t_{yi}}{\pi_{Ii}}\frac{t_{yj}}{\pi_{Ij}}
\end{align*}
Se procede análogamente para la estimación de la varianza.
\end{proof}

\begin{Res}
Si el diseño de muestreo $p_I(s_I)$ es de tamaño fijo, la varianza del estimador de Horvitz-Thompson y su varianza estimada toman la siguiente forma
\begin{align}
Var_2(\hat{t}_{y,\pi})
&=-\frac{1}{2}\sum\sum_{U_I}\Delta_{Iij}\left(\frac{t_{yi}}{\pi_{Ii}}-\frac{t_{yj}}{\pi_{Ij}}\right)^2\\
\widehat{Var}_2(\hat{t}_{y,\pi})
&=-\frac{1}{2}\sum\sum_{S_I}\frac{\Delta_{Iij}}{\pi_{Iij}}\left(\frac{t_{yi}}{\pi_{Ii}}-\frac{t_{yj}}{\pi_{Ijl}}\right)^2
\end{align}
Nótese que $\widehat{Var}_2(\hat{t}_{y,\pi})$ es insesgado para $Var_2(\hat{t}_{y,\pi})$.
\end{Res}

\begin{proof}
La demostración de los anteriores resultados es inmediata si\-guien\-do los lineamentos de la sección del estimador de Horvitz-Thompson del segundo capítulo y notando que $t_y=\sum_{U_I}t_{yi}$.
\end{proof}

Al respecto de la construcción del estimador de Horvitz-Thompson bajo mues\-treo en conglomerados, \citeasnoun{Baut} deduce que

\begin{enumerate}
  \item La eficiencia de la estrategia de muestreo toma su máximo valor cuando los valores $\dfrac{t_{yi}}{\pi_{Ii}}$ son constantes para todo $i=1,\ldots,N_I$.
  \item Cuando el diseño por conglomerados es tal que asigna probabilidades de inclusión idénticas a cada conglomerado, la estrategia pierde eficiencia, a menos que el comportamiento de los totales de cada conglomerado sea similar.
\end{enumerate}

Los anteriores comentarios nos llevan a preferir diseños de muestreo que asignen probabilidades de inclusión proporcionales al tamaño del conglomerado. Para esto se debería disponer de información auxiliar continua disponible para toda la población $U_I$ que estuviera bien correlacionada con los totales de la característica de interés en cada conglomerado $t_{yi}$. En otras palabras, nuestro marco de muestreo es de conglomerados; por tanto, si $x$ representa la información auxiliar continua y $t_{xi}$ el total de la información auxiliar en el $i$-ésimo conglomerado, la correlación entre $t_{xi}$ y $t_{yi}$ debería ser bastante fuerte y las probabilidades de inclusión de los conglomerados deberían corresponder a

\begin{align}
\pi_{Ii}=n_I\frac{t_{xi}}{t_x}
\end{align}

\begin{Eje}
Nuestra población ejemplo $U_I$ dada por

\begin{center}
$U_I$=\{\textbf{$U_1, U_2, U_3$}\}
\end{center}

Suponga que se selecciona una muestra $s_I$ de conglomerados de tamaño $n_I=2$ mediante un diseño de muestreo sin reemplazo tal que
\begin{equation*}
 p_I(s_I)=\begin{cases}
            0.5, & \text{si $s_I$=\{\textbf{$U_1, U_2$}\}},\\
            0.4, & \text{si $s_I$=\{\textbf{$U_1, U_3$}\}},\\
            0.1, & \text{si $s_I$=\{\textbf{$U_2, U_3$}\}}
            \end{cases}
\end{equation*}

Mediante el siguiente ejercicio léxico-gráfico se comprueba el insesgamiento del estimador de Horvitz-Thompson en \textsf{R}. Para esto utilizamos las funciones \texttt{Ik} y \texttt{Pik} del paquete \texttt{TeachingSampling} a nivel de los conglomerados.

<<>>=
p <- c(0.5, 0.4, 0.1)
Ind <- Ik(NI, nI)
data.frame(QI, p, Ind)
pikI <- Pik(p, Ind)
pikI
@

De esta manera, la probabilidad de inclusión más alta la tiene el conglomerado $U_1$ y la más baja corresponde al conglomerado $U_3$. Con esto podemos calcular la estimación mediante el uso de la función \texttt{HT} del paquete \texttt{TeachingSampling}.


<<warning=FALSE>>=
all.pikI <- Support(NI, nI, pikI)
all.tyI <- Support(NI, nI, tyI)
all.HT <- rep(NA, 3)

for(k in 1:3){
  all.HT[k] <- HT(all.tyI[k,], all.pikI[k,])
}

all.HT
sum(p * all.HT)
All.samples <- data.frame(QI, p, all.pikI, all.tyI, all.HT)
@

<<echo=FALSE, results = 'asis'>>=
All.samples <- data.frame(QI, p, all.pikI, all.tyI, all.HT)
T6.1 <- xtable(All.samples, caption ="\\emph{Estimaciones para todas las posibles muestras del ejemplo.}", label ="T6.1")
print(T6.1, caption.placement="bottom")
@

Una vez más, nótese que en la estimación intervienen las cantidades de los conglomerados seleccionados en la muestra realizada.
\end{Eje}

\subsubsection{Estimación de otros parámetros}

\index{Parámetros diferentes al total}Si el tamaño poblacional $N$ es conocido, la media poblacional definida en (\ref{media}) puede ser estimada con el estimador de Horvitz-Thompson.

\begin{Res}
En muestreo por conglomerado la media poblacional es estimada insesgadamente mediante el uso del estimador de Horvitz-Thompson
\begin{align}
\hat{\bar{Y}}_{\pi}&=\dfrac{1}{N}\left(\hat{t}_{y,\pi}\right)\\
&=\dfrac{1}{N}\sum_{i\in S_I}\frac{t_{yi}}{\pi_{Ii}}
\end{align}
\end{Res}

Una de las razones por las que se utiliza el muestreo por con\-glo\-me\-ra\-dos es la falta de un marco de muestreo para elementos. En este caso el desconocimiento del tamaño poblacional es muy típico. Sin embargo, utilizando los principios del estimador de Horvitz-Thompson, es posible estimar el tamaño de la población escribiéndolo como

\begin{equation}
N=\sum_{i\in U_I} N_i,
\end{equation}

Luego, tenemos el siguiente resultado.

\begin{Res}
En muestreo por conglomerados el tamaño poblacional es estimado insesgadamente mediante el uso de la siguiente expresión
\begin{equation}
\hat{N}_{\pi}=\sum_{i\in S_I}\frac{N_i}{\pi_{Ii}}
\end{equation}
\end{Res}

Una vez el tamaño de la población es estimado, es posible utilizar la razón de Hájek \cite{Hajek71} para estimar la media poblacional de la siguiente manera.
\begin{align}
\widetilde{y}_S&=\dfrac{\hat{t}_{y,\pi}}{\hat{N}_{\pi}}\\
&=\frac{\sum_{i\in S_I}\frac{t_{yi}}{\pi_{Ii}}}{\sum_{i\in S_I}\frac{N_i}{\pi_{Ii}}}
\end{align}

De hecho, en algunas ocasiones, cuando el diseño de muestreo utilizado induce probabilidades de inclusión desiguales, es  mejor utilizar este estimador aun conociendo el tamaño poblacional.

\subsection[El estimador de Hansen-Hurwitz]{El estimador de Hansen-Hurwitz}

Si la selección de los conglomerados se hace con reemplazo, ya sea utilizando un diseño de muestreo aleatorio simple con reemplazo o, en el caso de tener información auxiliar continua a nivel de los conglomerados, haciendo uso de un diseño de muestreo PPT, es posible utilizar los principios del estimador de Hansen-Hurwitz para completar la estrategia de muestreo.

En caso de tener acceso a información auxiliar continua, las probabilidad de selección del $i$-ésimo conglomerado estaría dada por

\begin{equation}
    p_{Ii}=\frac{t_{xi}}{t_x}
\end{equation}

\citeasnoun{Sam} afirma que en caso de conocerse los tamaños $N_i$ de cada cluster $i=1,\ldots,N_I$, estos mismos pueden ser utilizados como medidas de tamaño para desarrollar un plan de muestreo con probabilidades proporcionales. El esquema general del muestreo con reemplazo toma la siguiente forma:

\begin{itemize}
\item Para cada conglomerado de la población $U_I$, existen números positivos $p_{I1},\ldots,p_{IN_I}$ tales que
\begin{equation*}
\sum_{U_I}p_{Ii}=1.
\end{equation*}
Estas probabilidades no son necesariamente iguales.
\item Para seleccionar el primer elemento que pertenecerá a la muestra de tamaño $m_I$, se lleva a cabo un sorteo aleatorio de tal forma que
\begin{equation*}
Pr(\text{Seleccionar el conglomerado }i)=p_{Ii},\text{   $i \in U_I$}.
\end{equation*}
\item El conglomerado seleccionado es reemplazado en la población y vuelve a ser parte del próximo sorteo aleatorio con la misma probabilidad de selección. En total se realizan $m_I$ sorteos aleatorios independientes.
\end{itemize}

Nótese que el sorteo aleatorio se realiza entre los conglomerados, y no entre los elementos; por lo tanto, bajo muestreo en conglomerados no tiene sentido hablar de la probabilidad de selección de un elemento. Una vez que las probabilidades de selección de los conglomerados están definidas, utilizamos el estimador de Hansen-Hurwitz para estimar los parámetros de interés.

\begin{Res}
Bajo un diseño de muestreo por conglomerados, el estimador de Hansen-Hurwitz para el total $t_{y}$, su varianza y su varianza estimada están dados por
\begin{equation}
\hat{t}_{y,p}=\frac{1}{m_I}\sum_{v=1}^{m_I}\frac{t_{{yi}_v}}{p_{Ii_v}}
\end{equation}
\begin{equation}
Var(\hat{t}_{y,p})=\frac{1}{m_I}\sum_{i=1}^{N_I}p_{Ii}\left(\frac{t_{yi}}{p_{Ii}}-t_y\right)^2
\end{equation}
\begin{equation}
\widehat{Var}(\hat{t}_{y,p})=\frac{1}{m_I(m_I-1)}\sum_{v=1}^{m_I}\left(\frac{t_{yi_v}}{p_{Ii_v}}-\hat{t}_{y,p}\right)^2
\end{equation}
respectivamente. Nótese que $\hat{t}_{y,p}$ es insesgado para $t_y$ y que $\widehat{Var}(\hat{t}_{y,p})$ es insesgado para $Var(\hat{t}_{y,p})$.
\end{Res}

\begin{proof}
La demostración del resultado sigue los mismos argumentos de la sección del estimador de Hansen-Hurwitz del segundo capítulo y del resultado 2.2.11, definiendo la variable aleatoria $Z_v$ como
\begin{equation}
Z_v=t_{yi}/p_{Ii} \ \ \ \ \ \ i\in U_I \ \ \ v=1,\ldots,m_I
\end{equation}
y notando que
\begin{equation}
Pr\left(Z_v=t_{yi}/p_{Ii}\right)=p_{Ii}
\end{equation}
\end{proof}

\citeasnoun{Coc} afirma que el método de selección de muestras con reemplazo es equivalente al problema estándar de probabilidad en el cual $m_I$ bolas son depositadas en $N_I$ cajas, la probabilidad de que una bola sea depositada en la $i$-ésima caja está dada por $Z_v$ en cada oportunidad. De esta manera, la distribución conjunta de $n_{Ii}(s_I)$\footnote{$n_{Ii}(s_I)$ se define como el número de veces que el conglomerado $i$-ésimo es seleccionado en una muestra probabilística de tamaño $m_I$. Note que $n_{Ii}(s_I)$ toma valores $0,1,2,\ldots,m_I$.} está dada por una expresión multinomial.

\begin{Defi}
\index{Diseño de muestreo con reemplazo}De manera general, un diseño de muestreo con reemplazo de conglomerados se define como
\begin{equation}
p_I(s_I)= \begin{cases} \frac{m_I!}{n_{I1}(s_I)!\ldots n_{IN_I}(s_I)!}\prod_{U_I}(p_{Ii})^{n_{Ii}(s_I)}, &\text{si $\sum_{U_I}n_{Ii}(s_I)=m_I$}\\
0,  &\text{en otro caso}
      \end{cases}
\end{equation}
\end{Defi}

\begin{Eje}
Nuestra población ejemplo $U_I$ dada por
\begin{center}
$U_I=$\{\textbf{$U_1, U_2, U_3$}\}
\end{center}

Suponga que se selecciona una muestra $s_I$ con reemplazo de con\-glo\-me\-ra\-dos de tamaño $m_I=2$ mediante un diseño de muestreo que asigna las siguientes probabilidades de selección a cada conglomerado.
\begin{equation*}
 p_{Ii}=\begin{cases}
            0.80, & \text{si $i=1$},\\
            0.15, & \text{si $i=2$},\\
            0.05, & \text{si $i=3$}.
            \end{cases}
\end{equation*}

Para seleccionar una muestra con reemplazo de la población $U_I$ de tamaño $mI=2$ conglomerados se utiliza la función \texttt{sample} cuyo argumento \texttt{replace} debe aparecer igual a \texttt{TRUE}. Para esto definimos las probabilidades de selección de cada conglomerado.

<<>>=
UI <- c("U1", "U2", "U3")
NI <- 3
mI <- 2

pIi  <- c(0.8, 0.15, 0.05)
samI  <-  sample(NI, mI, replace=TRUE, prob=pIi)
mI   <-  UI[samI]
mI
@

En este caso particular la  muestra con reemplazo está compuesta por $U_3$ y, como era de esperarse, por tener la más alta probabilidad de selección, por $U_1$. Para estimar el total poblacional, utilizamos la función \texttt{HH} del paquete muestreo con los totales de los conglomerados seleccionados y sus respectivas probabilidades de selección.

<<>>=
tyIm  <-  tyI[samI]
tyIm
pIim  <-  pIi[samI]
data.frame(mI, pIim, tyIm)

HH(tyIm, pIim)[1]
@
\end{Eje}

\section{Muestreo aleatorio simple de conglomerados}

\index{Diseño de muestreo aleatorio de conglomerados}En esta sección se introducen los principios del diseño de muestreo por con\-glo\-me\-ra\-dos bajo el plan de muestreo más sencillo. La muestra $s_I$ de $n_I$ conglomerados  es seleccionada mediante un diseño de muestreo aleatorio simple sin reemplazo. Como se verá a lo largo de la sección, no hay nuevos principios (ni en el diseño de muestreo ni en el desarrollo del estimador) involucrados en la construcción de la estrategia de muestreo, la demostración de los resultados se hace siguiendo las pautas expuestas en el capítulo 2.

Este diseño de muestreo asume que el comportamiento del total de la característica de interés es constante en cada uno de los con\-glo\-me\-ra\-dos. En la práctica esta situación se presenta en muy pocas ocasiones, es por esto que este diseño pierde precisión, en la mayoría de ocasiones, ante el muestreo aleatorio simple. Para que este diseño de muestreo sea más eficiente el valor promedio de la característica de interés en cada cluster $\bar{y}_{U_i}$ debería ser proporcional a $\frac{c}{N_i}$. Se asume que la población $U_I$ está dividida en $N_I$ conglomerados (no necesariamente del mismo tamaño). La muestra sin reemplazo es seleccionada de acuerdo al diseño de muestreo dada en la siguiente definición.

\begin{Defi}
\index{Diseño de muestreo aleatorio de conglomerados}Un diseño de muestreo se dice aleatorio simple para con\-glo\-me\-ra\-dos si todas las posibles muestras de tamaño $n_I$ tienen la misma probabilidad de ser seleccionadas. Así,
\begin{equation}
p_I(s_I)= \begin{cases} \frac{1}{\binom{N_I}{n_I}} &\text{si $\#s_I=n_I$}\\
0  &\text{en otro caso}
      \end{cases}
\end{equation}
\end{Defi}

Una vez que la muestra de conglomerados $s_I$ es seleccionada se dispone a realizar una enumeración completa y la respectiva medición y observación de todos y cada uno de los elementos pertenecientes a cada conglomerado seleccionado.

\subsection{Algoritmos de selección}

\index{Algoritmos de selección}En la selección de las muestras de conglomerados sin reemplazo es posible utilizar los algoritmos de muestreo dados en el capítulo 2, de tal forma que los siguientes pasos se deben realizar:

\begin{itemize}
  \item Separar la población en $N_I$ conglomerados mediante el marco de muestreo de conglomerados.
  \item Realizar una selección de $n_I$ conglomerados mediante cualquiera de los métodos expuestos en la sección 3.2.1; es decir, por el método coordinado negativo o por el método de Fan-Muller-Rezucha.
\end{itemize}

\subsection[El estimador de Horvitz-Thompson]{El estimador de Horvitz-Thompson}

Siguiendo el resultado 6.1.1. las probabilidades de inclusión están dadas por el siguiente resultado.

\begin{Res} Para un diseño de muestreo aleatorio de conglomerados, las probabilidades de inclusión de primer y segundo orden de los con\-glo\-me\-ra\-dos están dadas por
\begin{eqnarray}
  \pi_{Ii}  &=& \frac{n_I}{N_I} \\
  \pi_{Iij} &=& \frac{n_I(n_I-1)}{N_I(N_I-1)}
\end{eqnarray}
respectivamente.
\end{Res}

\begin{Res}
El tamaño de la muestra de elemento $s$ es aleatorio y su es\-pe\-ran\-za está dada por
\begin{equation}
E(n(S))=N\frac{n_I}{N_I}
\end{equation}
\end{Res}

\begin{proof}
De la definición de tamaño de muestra esperado, se tiene que
\begin{equation}
E(n(S))=E\left(\sum_{i\in S_I}N_i\right)=\sum_{i\in U_I}N_i\frac{n_I}{N_I}=N\frac{n_I}{N_I}
\end{equation}
\end{proof}

Se sigue del resultado 6.1.2 que la estrategia de muestreo se construye me\-dian\-te el uso del estimador de Horvitz-Thompson que bajo este diseño de muestreo particular toma la forma del siguiente resultado.

\begin{Res} Para un diseño de muestreo aleatorio de conglomerados, el estimador de Horvitz-Thompson del total poblacional $t_y$, su varianza y su varianza estimada están dados por
\begin{equation}
\hat{t}_{y,\pi}=\frac{N_I}{n_I}\sum_{S_I}t_{yi}
\end{equation}
\begin{equation}
Var_{MAC}(\hat{t}_{y,\pi})=\frac{N_I^2}{n_I}\left(1-\frac{n_I}{N_I}\right)S^2_{t_{yU_I}}
\end{equation}
\begin{equation}
\widehat{Var}_{MAC}(\hat{t}_{y,\pi})=\frac{N_I^2}{n_I}\left(1-\frac{n_I}{N_I}\right)S^2_{t_{ys_I}}
\end{equation}
respectivamente, con $S^2_{t_{yU_I}}$ y $S^2_{t_{ys_I}}$ el estimador de la varianza de los totales de los conglomerados para la característica de interés en el universo $U_I$ y en la muestra $s_I$. Esto es
\begin{equation*}
S^2_{t_{yU_I}}=\frac{1}{N_I-1}\sum_{i\in U_I}(t_{yi}-\bar{t}_{U_I})^2,
\end{equation*}
donde $\bar{t}_{U_I}=\sum_{i=1}^{N_I}t_{yi}/N_I$, y $S^2_{t_{yS_I}}$ se define de manera análoga. Nótese que $\hat{t}_{y,\pi}$ es insesgado para el total poblacional $t_y$ de la característica de interés $y$, y que $\widehat{Var}_{MAC}(\hat{t}_{y,\pi})$ es insesgado para $Var_{MAC}(\hat{t}_{y,\pi})$.
\end{Res}

Nótese que el diseño de muestreo sistemático en un caso especial del muestreo aleatorio de conglomerados cuando se selecciona una muestra $s_I$ de tamaño igual a $n_I=1$. Al igual que en muestreo sistemático no se tiene un estimador de la varianza cuando se selecciona sólo un conglomerado.


\begin{Eje}
Siguiendo con nuestra población ejemplo $U_I$, existen $\binom{N_I}{m_I}=\binom{3}{2}=3$ posibles muestras de tamaño $m_I=2$. Realice el cálculo léxico-gráfico del estimador de Horvitz-Thompson y compruebe el insesgamiento y la varianza mediante este diseño de muestreo.
\end{Eje}

\subsubsection{Tamaño de muestra}

\index{Tamaño de muestra}Bajo muestreo aleatorio de conglomerados se utilizan los mismos principios de la estimación del tamaño de muestra en muestreo aleatorio simple reemplazando las cantidades correspondientes de la población de elementos por la población de conglomerados $U_I$. De tal forma que si requiere estimar el tamaño de muestra dada una precisión absoluta $c$ se tiene:

\begin{align}
n_I\geq\frac{n_{I0}}{1+\frac{n_{I0}}{N_I}}
\end{align}

con $n_{I0}=\dfrac{t^2_{1-\alpha/2,N_I-1}S^2_{t_{yU_I}}}{c^2}$. En algunas ocasiones se quiere lograr una precisión relativa $k$, por tanto:

\begin{align}
n_I\geq\frac{n_{I0}}{1+\frac{n_{I0}}{N_I}}
\end{align}

con $n_{I0}=\dfrac{t^2_{1-\alpha/2,N_I-1}CV^2}{k^2}$. Nótese que dado que la población de conglomerados es pequeña, en la mayoría de los casos, es preferible suponer que el estimador sigue una distribución t-student con $N_I-1$ grados de libertad.

\subsection{Eficiencia de la estrategia}

\index{Eficiencia de la estrategia}A lo largo del capítulo se ha mencionado que la eficiencia de esta estrategia de muestreo es menor que la del muestreo aleatorio simple sin reemplazo. Intuitivamente se sospecha que, dado que la formación de grupos se presenta en forma natural en la mayoría de los casos, la información de los conglomerados, con res\-pec\-to al comportamiento estructural de la característica de interés, es homogénea dentro de cada uno de ellos.

Para corroborar las anteriores afirmaciones vamos a medir la eficiencia de la estrategia utilizando el efecto de diseño. Sin embargo, para unificar el tamaño de la muestra en esta estrategia se supondrá que:

\begin{enumerate}
  \item La población $U_I$ está conformada por $N_I$ conglomerados.
  \item Cada conglomerado es de tamaño $M$. Luego $\#U_i=M \ \ \ i=1,\ldots,N_I$, además la población de elementos $U$ es de tamaño $N=M\times N_I$.
  \item Se selecciona una muestra $s_I$ de tamaño igual a $n_I$ conglomerados. De esta forma se han seleccionado en la muestra $M\times n_I$ elementos.
\end{enumerate}

\begin{table}[h]
\centering
\caption[Tabla de ANOVA por conglomerados]{\emph{Tabla de ANOVA inducida por el muestreo aleatorio de conglomerados.}}
\begin{tabular}{cccc}\hline\hline
Fuente         &gl  &Suma de cuadrados                                             &Cuadrado medio\\\hline
Entre          &$N_I-1$              &$SCE=\sum_{i=1}^{N_I}M\left(\bar{y}_{U_i}-\bar{y}_U\right)^2$                &$\dfrac{SCE}{N_I-1}$\\\\
Dentro         &$N_IM-N_I$           &$SCD=\sum_{i=1}^{N_I}\sum_{j=1}^{M}\left(y_{ij}-\bar{y}_{U_i}\right)^2$      &$\dfrac{SCD}{N_IM-N_I}$\\\hline
Total          &$N_IM-1$             &$SCT=\sum_{i=1}^{N_I}\sum_{j=1}^{M}\left(y_{ij}-\bar{y}_U\right)^2$          &$s^2_{y_U}$\\\hline\hline
\end{tabular}
\end{table}

Los resultados podrán ser comparables si se supone que una muestra de $n_I$ conglomerados es seleccionada de acuerdo a un diseño aleatorio simple de conglomerados. Por otro lado, se supone que se selecciona una muestra de $M\times n_I$ elementos directamente de la población $U$. Cada vez que la población es dividida en sub-grupos poblacionales es muy útil recurrir a la tabla de análisis de varianza que esta vez toma la forma dada en la tabla 6.1.

\begin{Res}
Utilizando los resultados de la descomposición de las sumas de cuadrados, la varianza de la estrategia por conglomerados toma la siguiente forma
\begin{equation}
Var_{MAC}(\hat{t}_{y,\pi})=\frac{N_I^2}{n_I}\left(1-\frac{n_I}{N_I}\right)M\frac{SCE}{N_I-1}
\end{equation}
mientras que la varianza de la estrategia aleatoria simple, con un tamaño poblacional igual a $N=M\times N_I$ elementos y un tamaño de muestra igual a $n=M\times n_I$ elementos, se puede escribir como
\begin{equation}
Var_{MAS}(\hat{t}_{y,\pi})=\frac{N_I^2}{n_I}\left(1-\frac{n_I}{N_I}\right)M\frac{SCT}{MN_I-1}
\end{equation}
\end{Res}

\begin{proof}
Para la varianza de la estrategia por conglomerados se tiene
\begin{align*}
M\frac{SCE}{N_I-1}&=\frac{\sum_{i=1}^{N_I}M^2\left(\bar{y}_{U_i}-\bar{y}_U\right)^2}{N_I-1}\\
&=\frac{\sum_{i=1}^{N_I}\left(t_{yi}-\bar{t}_{yU_I}\right)^2}{N_I-1}\\
&=S^2_{t_{yU_I}}
\end{align*}
donde $\bar{y}_{U_i}$ y $t_{yi}$ es el promedio y el total del $i$-ésimo conglomerado, respectivamente y $\bar{t}_{yU_I}=\frac{\sum_{i=1}^{N_I}t_{yi}}{N_I}$ es el promedio de los totales de los conglomerados.

Para la varianza de la estrategia aleatoria simple sólo hay que notar que
\begin{align*}
\frac{N^2}{n}\left(1-\frac{n}{N}\right)&=\frac{(MN_I)^2}{Mn_I}\left(1-\frac{Mn_I}{MN_I}\right)\\
&=\frac{N_I^2}{n_I}\left(1-\frac{n_I}{N_I}\right)M
\end{align*}
\end{proof}

Note que si $SCE$ es alta, entonces la estrategia será menos eficiente. En la práctica es esto lo que ocurre exactamente pues dada la agrupación natural de elementos, el comportamiento de la característica de interés será similar dentro de cada conglomerado. Por tanto, $SCE$ será elevada pues en forma general los conglomerados presentarán un comportamiento heterogéneo. Para verlo con más claridad, se define el coeficiente de correlación intra-clase como

\begin{equation}
\rho=1-\frac{M}{M-1}\frac{SCD}{SCT}
\end{equation}

Esta medida toma valores positivos si los elementos dentro de los conglomerados tienen un comportamiento similar y negativo cuando el comportamiento de los elementos dentro de los con\-glo\-me\-ra\-dos es muy disperso. Además, el coeficiente informa qué tan similares son los elementos dentro de los conglomerados y proporciona una medida de homogeneidad dentro de los conglomerados y nos da una realidad más detallada en cuanto al efecto de diseño y pérdida de eficiencia en el muestreo aleatorio de conglomerados como lo afirma el siguiente resultado.

\begin{Res}
El efecto de diseño en muestreo aleatorio de con\-glo\-me\-ra\-dos está dado por
\begin{equation}\label{defcon}
    Deff=\frac{Var_{MAC}\hat{t}_{\pi}}{Var_{MAS}\hat{t}_{\pi}}\cong1+(M-1)\rho
\end{equation}
\end{Res}

\begin{proof}
La aproximación se tiene si se supone que $N_I$, el número total de conglomerados, es grande tal que
\begin{equation}
M(N_I-1)\cong MN_I-1
\end{equation}
La demostración se completa notando que al realizar el cociente de varianzas, al igual que en la sección del muestreo sistemático, se tiene que
\begin{equation}
\frac{SCE}{SCT}=\frac{1+(M-1)\rho}{M}
\end{equation}
\end{proof}

Dado que $\rho$ es generalmente positivo\footnote{Esto se da porque los conglomerados se forman física y geográficamente como agrupaciones contiguas de elementos que comparten un ambiente natural, entonces el comportamiento de los elementos internamente será similar.} podemos inferir de (\ref{defcon}) que el mues\-treo por conglomerados tendrá una mayor varianza que el muestreo aleatorio simple de elementos directamente de la población $U$. Sin embargo, es plausible sacrificar la eficiencia estadística por el ahorro financiero y logístico característico de las estrategias por conglomerados. Ahora, si $\rho$ es negativo, esta estrategia gana en eficiencia y también en costos operativos.

\citeasnoun{Loh} afirma que en el caso, muy común en la práctica, en que los conglomerados no sean del mismo tamaño, una medida alternativa a $\rho$ es el coeficiente de determinación $R^2$ definido como

\begin{equation}
R^2=1-\frac{CMD}{s^2_{y_U}}
\end{equation}

donde $CMD=\frac{SCD}{N-N_I}$; con $N$ el número total de elementos en la población $U$. Ésta es una medida muy conocida y utilizada en el análisis de regresión lineal, y es interpretada como la cantidad de variabilidad explicada por los promedios de cada conglomerado. Si el comportamiento de la ca\-rac\-te\-rís\-ti\-ca de interés es homogéneo dentro de los conglomerados, entonces los promedios entre los conglomerados tendrán una muy alta dispersión con respecto a la variación dentro de los conglomerados y $R^2$ tomará valores grandes.


\subsection{Marco I y Lucy}

\index{Marco y Lucy}El común denominador de las aplicaciones prácticas con Marco y Lucy en los capítulos anteriores ha sido la identificación y ubicación, a priori, de cada una de las empresas en el sector industrial. Esto ha sido posible gracias a que un marco de muestreo de elementos estuvo disponible. En algunas ocasiones, el marco de muestreo disponible mostró bondades que permitieron la incorporación de información auxiliar, ya sea de tipo continuo o categórico, para mejorar la eficiencia de la estrategia de muestreo utilizada en cada caso.

En cualquier caso, el gobierno desea obtener estimaciones precisas que le permitan fortalecer sus políticas de apoyo y financiamiento de las empresas en el sector industrial. Sin embargo, el gobierno no está en disposición de entregar una lista de todas las empresas del sector industrial con su respectiva identificación y ubicación debido a políticas de confidencialidad que no le permiten brindar este tipo de información. Por tanto, en esta ocasión no hay tal marco generoso de elementos en la población y el estudio se deberá llevar a cabo con esta restricción de tipo logístico.

En cualquier estudio por muestreo, siempre debe existir, si no físicamente al menos de forma implícita, un marco de muestreo de la población que permita llegar a la medición de la unidad objetivo de muestreo. Dado que el gobierno no permite la utilización de un marco de muestreo de empresas en el sector industrial, se debe realizar el levantamiento de un marco de muestreo de conglomerados que agrupen estas empresas. Una solución, que es muy utilizada en la práctica, es realizar un muestreo de áreas geográficas. Las empresas, las viviendas, los domicilios, los negocios, etc. están ubicadas en algún lugar del mapa y es poco factible que se muevan de donde han estado instaladas. Por tanto, un marco de muestreo por áreas es una buena solución de tipo logístico para enfrentar la etapa de diseño de este estudio.

Un inconveniente que se presenta a la hora de realizar un muestreo de conglomerados con un marco discriminado en áreas geográficas es la imposibilidad de conocer cuántas empresas estarán ubicadas en cada zona geográfica. Sin embargo, sí es posible asignar subdivisiones de cada zona geográfica seleccionada a un grupo de encuestadores para que recorran la zona y apliquen el cuestionario a cada una de las empresas del sector. De esta forma, es posible tener una estimación del presupuesto que se requiere. La población $U_I$ de conglomerados, es decir la ciudad, se divide en cinco zonas geográficas, a saber: \textbf{Zona A}, ubicada en el sur, \textbf{Zona B}, ubicada en el norte, \textbf{Zona C}, ubicada en el oriente, \textbf{Zona D}, ubicada en el occidente y  \textbf{Zona E}, ubicada en el centro.

Recordando los objetivos del estudio, el gobierno quiere medir el cre\-ci\-mien\-to del sector industrial en la ciudad, mediante tres características importantes: el ingreso y los impuestos declarados en el último año fiscal y la generación de empleos mediante la cantidad de trabajadores que laboran en cada empresa. Seguramente, ni el ingreso, ni los impuestos, ni la cantidad de empleados están correlacionados con la zona geográfica. Podemos afirmar esto porque la ubicación de las empresas es realizada por el gobierno siguiendo diversos criterios.

\begin{figure}[htb]
<<message=FALSE, fig.height=5>>=
qplot(Zone, Employees, data=BigLucy, geom=c("boxplot"))
@
\caption{\emph{Boxplot de la característica de interés \texttt{Employees} para cada una de las zonas.}}
\label{F6.2}
\end{figure}

Es así como en una misma zona geográfica, es posible encontrar una empresa grande rodeada de empresas pequeñas o medianas. Este es un muy buen indicio en la etapa del diseño de muestreo pues quiere decir que el comportamiento de las características de interés dentro de cada área geo\-grá\-fi\-ca es muy disperso. La figura \ref{F6.2} presenta el comportamiento de las características de interés en cada una de las cinco zonas geográficas de la ciudad. Nótese que no es posible identificar un comportamiento estructural significativamente diferente en cada zona, sino que por el contrario, el comportamiento es heterogéneo dentro de cada zona y homogéneo entre las zonas.

Aunque no se conoce el número de empresas en el sector industrial, el gobierno ha estimado según datos de años anteriores la existencia de 85000 empresas para el último año fiscal. Con esta información se ha decidido seleccionar una muestra aleatoria simple de conglomerados de tamaño $n_I=10$. Por tanto, el tamaño muestral de empresas esperado corresponde a $85000\dfrac{10}{100}=8500$. De la población de $N_I=100$ conglomerados de áreas se selecciona una muestra aleatoria simple de $n_I=10$ utilizando la función \texttt{S.SI} del paquete muestreo. En este caso particular, los conglomerados incluidos en la muestra sin reemplazo corresponde a la \textbf{Zona A} y a la \textbf{Zona E}.

<<>>=
UI <- levels(BigLucy$Zone)
NI <- length(UI)
nI <- 10

samI <- S.SI(NI, nI)
muestra <- UI[samI]
muestra
@

Un equipo de encuestadores se dispone a recolectar la información de cada una de las empresas pertenecientes a los conglomerados seleccionados, el plan operativo es más eficiente entre más entrevistadores sean contratados por cada conglomerado seleccionado. Cuando el proceso de medición termina se tienen dos conjuntos de datos, cada una conteniendo el valor de las características de interés para cada una de las empresas del área, correspondientes a \textbf{Zona A} y \textbf{Zona E}.

Con la función \texttt{rbind} es posible unir la información de las zonas geográficas seleccionadas en la muestra. Con ayuda de la función \texttt{T.SIC(y,C)}, del paquete \texttt{TeachingSampling}, es posible obtener los totales de las características de interés en cada conglomerado. Los argumentos de esta función son \texttt{y}, el conjunto de datos (una sola variable o un conjunto de variables) del censo en cada conglomerado y \texttt{C}, una variable que indica la pertenencia del elemento, en este caso de las empresas, al conglomerado. El resultado de la función es el total de elementos en cada conglomerado, así como el total de las características de interés en cada uno de los conglomerados. En este caso particular, el tamaño de la muestra de empresas es $307 + 165=  472$. Nótese que, como en los casos de estimación de los capítulos anteriores, se crea un conjunto de datos de las características de interés definido por \texttt{estima <- data.frame(Income, Employees, Taxes)}.

<<message=FALSE>>=
data(BigLucy)
attach(BigLucy)

Lucy1 <- BigLucy[which(Zone == muestra[1]),]
Lucy2 <- BigLucy[which(Zone == muestra[2]),]
Lucy3 <- BigLucy[which(Zone == muestra[3]),]
Lucy4 <- BigLucy[which(Zone == muestra[4]),]
Lucy5 <- BigLucy[which(Zone == muestra[5]),]
Lucy6 <- BigLucy[which(Zone == muestra[6]),]
Lucy7 <- BigLucy[which(Zone == muestra[7]),]
Lucy8 <- BigLucy[which(Zone == muestra[8]),]
Lucy9 <- BigLucy[which(Zone == muestra[9]),]
Lucy10 <- BigLucy[which(Zone == muestra[10]),]

LucyI <- rbind(Lucy1, Lucy2, Lucy3, Lucy4, Lucy5, Lucy6, Lucy7, Lucy8, Lucy9, Lucy10)
attach(LucyI)

Area <- as.factor(as.integer(Zone))
estima <- data.frame(Income, Employees, Taxes)
estimaI <- as.data.frame(T.SIC(estima,Area))
estimaI
@

El tamaño de muestra efectivo fue \Sexpr{sum(estimaI[,1])}. Una vez que se tienen los totales de cada zona geográfica, se utiliza la función \texttt{E.SI(NI,nI,y)} del paquete \texttt{TeachingSampling}, definida en el capítulo dos, para obtener las estimaciones de los parámetros de interés.

<<results='hide'>>=
E.SI(NI, nI, estimaI)
@

Los resultados de la estimación se muestran en la siguiente tabla. Es de considerar que la eficiencia de esta estrategia de muestreo es mucho menor que la de una estrategia que utilice un diseño de muestreo aleatorio simple. Nótese que la desviación relativa es mucho mayor.


<<echo = FALSE, results = 'asis'>>=
Estimaciones = E.SI(NI, nI, estimaI)
T6.1 <- xtable(Estimaciones, caption ="\\emph{Estimaciones para el diseño de muestreo aleatorio simple de conglomerados.}", label ="T6.1")
print(T6.1, caption.placement="bottom")
@

Es claro que los resultados de esta estrategia de muestreo no son satisfactorios, por lo menos para la estimación de los parámetros de interés de Ingreso e Impuestos. La explicación de la deficiencia de esta estrategia es inmediata al analizar el siguiente gráfico que muestra el comportamiento estructural de los totales en los conglomerados.

\begin{figure}[!h]
<<fig.height=5>>=
par(mfrow = c(2,2))
barplot(estimaI$Income, main = "Totales de Income")
barplot(estimaI$Employees, main = "Totales de Employees")
barplot(estimaI$Taxes, main = "Totales de Taxes")
barplot(estimaI$Ni, main = "Tamaños de los conglomerados")
@
\caption{\emph{Boxplot de las características de interés en cada nivel industrial.}}
\label{F6.3}
\end{figure}

Es notable como el comportamiento de los totales es tan diferente en cada conglomerado en las características Ingreso y Empleados. Sin embargo, el comportamiento es similar en cuanto a la característica Impuestos. Es interesante observar que entre más disimilitud existe entre los totales de los conglomerados, más desviación relativa existe en la estimación. Como se dijo en la introducción de este capítulo, esta estrategia de muestreo es ineficiente en aquellos casos en que los totales de cada conglomerado no están correlacionados con las probabilidades de inclusión a nivel de conglomerados. Observando el gráfico, se establece que Impuestos es la única característica que presenta un comportamiento estable en relación a los conglomerados.

La regla de oro se mantiene, una estrategia de muestreo es eficiente si las probabilidades de inclusión están correlacionadas con los valores de la característica de interés, en este caso con los totales de cada conglomerados.